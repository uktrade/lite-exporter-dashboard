@import models.enums.StatusTypeFilter
@import models.view.ApplicationListView
@import page._
@import play.data.Form
@import util._
@import models.enums.ApplicationListTab
@(applyLink: String, applicationListView: ApplicationListView)
@standardPage("Export licence application management", Some(Html("Export licence application management")), hideBackLink = true, twoThirdsColumn = false) {

} {

  @dashboardTopNav(applyLink)

  <div class="heading-medium">Applications</div>

  @tabs("application-list-tabs", size = "large", width = "wide") {
    @tab("Created by you",
      applicationListView.getApplicationRoute.setApplicationListTab(ApplicationListTab.USER).toString,
      applicationListView.getApplicationListTab == ApplicationListTab.USER)
    @tab("Created by your company",
      applicationListView.getApplicationRoute.setApplicationListTab(ApplicationListTab.COMPANY).toString,
      applicationListView.getApplicationListTab == ApplicationListTab.COMPANY)
  }

  <div class="form-group">
    <label class="form-label left-label" for="select-box">Filter by company name</label>
    <form action="@applicationListView.getApplicationRoute.setCompanyId(null).toString" method="GET">
      <select class="form-control" id="company" name="company" onChange="this.form.submit()">
        <option @if(applicationListView.getCompanyId == null) {
          selected=""
        }
        value="all">All companies
        </option>
        @for(companySelectItemView <- applicationListView.getCompanySelectItemViews) {
          <option
            @if(companySelectItemView.getCompanyId == applicationListView.getCompanyId) {
              selected=""
            }
          value="@companySelectItemView.getCompanyId">@companySelectItemView.getCompanyName </option>
        }
        @if(applicationListView.getApplicationListTab != null) {
          <input type="hidden" name="tab" value="@applicationListView.getApplicationListTab"/>
        }
        @if(applicationListView.getDate != null) {
          <input type="hidden" name="date" value="@applicationListView.getDate"/>
        }
        @if(applicationListView.getStatus != null) {
          <input type="hidden" name="status" value="@applicationListView.getStatus"/>
        }
        @if(applicationListView.getCreatedBy!=null) {
          <input type="hidden" name="createdBy" value="@applicationListView.getCreatedBy"/>
        }
        @if(applicationListView.getStatusTypeFilter != null) {
          <input type="hidden" name="show" value="@applicationListView.getStatusTypeFilter.toString.toLowerCase"/>
        }
        @if(applicationListView.getPage.getCurrentPage != 0) {
          <input type="hidden" name="page" value="@applicationListView.getPage.getCurrentPage"/>
        }
      </select>
    </form>
  </div>

  <div class="table-filters">
    Show:
    <ul>
      <li @if(applicationListView.getStatusTypeFilter == StatusTypeFilter.ALL || applicationListView.getStatusTypeFilter == null) {
        class="active" }>
        <a href="@applicationListView.getApplicationRoute.setStatusTypeFilter(null).toString">
          All (@applicationListView.getAllCount)
        </a>
      </li>
      <li @if(applicationListView.getStatusTypeFilter == StatusTypeFilter.DRAFT) {
        class="active"}>
        <a href="@applicationListView.getApplicationRoute.setStatusTypeFilter(StatusTypeFilter.DRAFT).toString">
          Draft (@applicationListView.getDraftCount)
        </a>
      </li>
      <li @if(applicationListView.getStatusTypeFilter == StatusTypeFilter.CURRENT) {
        class="active"}>
        <a href="@applicationListView.getApplicationRoute.setStatusTypeFilter(StatusTypeFilter.CURRENT).toString">
          Current (@applicationListView.getCurrentCount)
        </a>
      </li>
      <li
        @if(applicationListView.getStatusTypeFilter == StatusTypeFilter.COMPLETED) {
          class="active"}>
        <a href="@applicationListView.getApplicationRoute.setStatusTypeFilter(StatusTypeFilter.COMPLETED).toString">
          Completed (@applicationListView.getCompletedCount)
        </a>
      </li>
    </ul>
  </div>

  <div class="scrollable-table">
    <table class="table-font-xsmall table-align-top">
      <thead>
        <tr>
          <th nowrap>
            <a href="@applicationListView.getApplicationRoute.nextDate().toString">
              Date submitted
            </a>
            @sortArrow(applicationListView.getDate)
          </th>
          <th>
            References
          </th>
          <th nowrap>
            <a href="@applicationListView.getApplicationRoute.nextStatus().toString">
              Application status
            </a>
            @sortArrow(applicationListView.getStatus)
          </th>
          <th>
            Destination
          </th>
          @if(applicationListView.getApplicationListTab == ApplicationListTab.COMPANY) {
            <th nowrap>
              <a href="@applicationListView.getApplicationRoute.nextCreatedBy().toString">
                Created by
              </a>
              @sortArrow(applicationListView.getCreatedBy)
            </th>
          }
        </tr>
      </thead>
      <tbody>
      @for(applicationItemView <- applicationListView.getPage.getItems) {
        <tr>
          <th scope="row">
          @applicationItemView.getDateSubmitted
          </th>
          <td>
            <a href="@routes.ApplicationDetailsController.statusTab(applicationItemView.getAppId)" class="bold">
            @applicationItemView.getAppId
            </a>
            <br>
            @applicationItemView.getCaseDescription
          </td>
          <td>
            <p>
              @applicationItemView.getApplicationStatus
            <br>
            @applicationItemView.getApplicationStatusDate
            </p>
            @if(applicationItemView.getOpenRfiId != null) {
              @rfiLabel(routes.ApplicationDetailsController.rfiTab(applicationItemView.getAppId).withFragment(applicationItemView.getOpenRfiId).toString)
            }
          </td>
          <td>
          @applicationItemView.getDestination
          </td>
          @if(applicationListView.getApplicationListTab == ApplicationListTab.COMPANY) {
            <td>
            @applicationItemView.getApplicantReference
            </td>
          }
        </tr>
      }
      </tbody>
    </table>
  </div>

  </p>
  <table>
    <tr>
      @if(applicationListView.getPage.getTotal != 0) {
        <td align="left" width="100%" style="border: 0">
          Showing @applicationListView.getPage.getFrom - @applicationListView.getPage.getTo of @applicationListView.getPage.getTotal applications
        </td>
      }
      @if(applicationListView.getPage.getPageCount != 1) {
        <td align="right" nowrap style="padding: 0;
          margin: 0;
          border: 0">
          @for(i <- 1 to applicationListView.getPage.getPageCount) {
            @if(i != applicationListView.getPage.getCurrentPage) {
              <a href="@applicationListView.getApplicationRoute.setPage(i).toString">@i</a>
            } else {
              @i
            }
            @if(i < applicationListView.getPage.getPageCount) {
              <span style="display: inline-block;
                width: 1em"> </span>
            }
          }
          @if(applicationListView.getPage.getCurrentPage < applicationListView.getPage.getPageCount) {
            <span style="display: inline-block;
              width: 1em"> </span>
            <a href="@applicationListView.getApplicationRoute.setPage(applicationListView.getPage.getCurrentPage + 1).toString">
              Next
            </a>
          }
        </td>
      }
    </tr>
  </table>
}