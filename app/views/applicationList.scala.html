@import models.enums.{ApplicationListTab, ApplicationSortType, ApplicationProgress}
@import models.view.ApplicationListView
@import template._
@(applyLink: String, applicationListView: ApplicationListView)
  @standardPage("Export licence application management", Some(Html("Export licence application management")), hideBackLink = true, twoThirdsColumn = false) {

  } {

    @dashboardTopNav(applyLink)

    <div class="heading-medium">Applications</div>

    @tabs("application-list-tabs", size = "large", width = "wide") {
      @tab("Created by you",
        applicationListView.getApplicationRoute.setApplicationListTab(ApplicationListTab.USER).toString,
        applicationListView.getApplicationListTab == ApplicationListTab.USER)
      @if(applicationListView.isShowCompanyTab) {
        @tab("Created by your company",
          applicationListView.getApplicationRoute.setApplicationListTab(ApplicationListTab.COMPANY).toString,
          applicationListView.getApplicationListTab == ApplicationListTab.COMPANY)
      }
    }

    @if(applicationListView.getCompanySelectItemViews.size() > 1) {
      @companySelect(applicationListView)
    }

    @statusPanel(applicationListView)

    <div class="scrollable-table">
      <table class="table-font-xsmall table-align-top">
        <thead>
          <tr>
            <th nowrap>
              <a href="@applicationListView.getApplicationRoute.nextSort(ApplicationSortType.DATE).toString">
              @if(applicationListView.getApplicationProgress == ApplicationProgress.DRAFT) {
                Date created
              } else {
                Date submitted
              }
              </a>
              @if(applicationListView.getApplicationSortType == ApplicationSortType.DATE) {
                @sortArrow(applicationListView.getSortDirection)
              } else {
                @sortArrow(null)
              }
            </th>
            <th>
              References
            </th>
            <th nowrap>
              <a href="@applicationListView.getApplicationRoute.nextSort(ApplicationSortType.STATUS).toString">
                Application status
              </a>
              @if(applicationListView.getApplicationSortType == ApplicationSortType.STATUS) {
                @sortArrow(applicationListView.getSortDirection)
              } else {
                @sortArrow(null)
              }
            </th>
            <th>
              Destination
            </th>
            @if(applicationListView.getApplicationListTab == ApplicationListTab.COMPANY) {
              <th nowrap>
                <a href="@applicationListView.getApplicationRoute.nextSort(ApplicationSortType.CREATED_BY).toString">
                  Created by
                </a>
                @if(applicationListView.getApplicationSortType == ApplicationSortType.CREATED_BY) {
                  @sortArrow(applicationListView.getSortDirection)
                } else {
                  @sortArrow(null)
                }
              </th>
            }
          </tr>
        </thead>
        <tbody>
        @for(applicationItemView <- applicationListView.getPage.getItems) {
          <tr>
            <th scope="row">
            @if(applicationListView.getApplicationProgress != ApplicationProgress.DRAFT) {
              @applicationItemView.getDate
            }
            </th>
            <td>
            @if(applicationItemView.getCaseId != null) {
              <a href="@routes.StatusTabController.showStatusTab(applicationItemView.getAppId)" class="bold">
              @applicationItemView.getCaseId
              </a>
              <br>
              @applicationItemView.getCaseDescription
            } else {
              <a href="#" class="bold">
              @applicationItemView.getCaseDescription
              </a>
            }
            </td>
            <td>
              <p>
                @applicationItemView.getApplicationStatus
              <br>
              @applicationItemView.getApplicationStatusDate
              </p>
              @if(applicationItemView.getOpenRfiId != null) {
                @rfiLabel(routes.RfiTabController.showRfiTab(applicationItemView.getAppId).withFragment(applicationItemView.getOpenRfiId).toString)
              }
            </td>
            <td>
            @applicationItemView.getDestination
            </td>
            @if(applicationListView.getApplicationListTab == ApplicationListTab.COMPANY) {
              <td>
              @applicationItemView.getCreatedByName
              </td>
            }
          </tr>
        }
        </tbody>
      </table>
    </div>

    <p>
    @applicationListFooter(applicationListView)
    </p>

  }
