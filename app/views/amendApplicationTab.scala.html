@import models.enums.Action
@import models.view.{ApplicationSummaryView, AmendmentView, ApplicationTabsView, PreviousRequestItemView}
@import template._

@(applyLink: String, applicationSummaryView: ApplicationSummaryView, applicationTabsView: ApplicationTabsView, amendmentView: AmendmentView, form: play.data.Form[_])

@applicationDetails(applyLink, applicationSummaryView, "amend", applicationTabsView, form) {
  @if(!amendmentView.getPreviousRequestItemViews.isEmpty) {
    <div class="heading-medium">
      Previous requests
    </div>
    <div class="scrollable-table">
      <table class="table-align-top">
        <thead>
          <tr>
            <th role="columnheader">
              Date
            </th>
            <th role="columnheader">
              Type
            </th>
            <th role="columnheader">
              Details
            </th>
          </tr>
        </thead>
        <tbody>
        @for(previousRequestItemView <- amendmentView.getPreviousRequestItemViews) {
          <tr>
            <td class="no-wrap">
              @previousRequestItemView.getDate
            </td>
            <td>
              @previousRequestItemView.getType
              @if(previousRequestItemView.getIndicator!=null) {
                (@previousRequestItemView.getIndicator)
              }
            </td>
            <td>
              <a href="@previousRequestItemView.getLink">View</a>
            </td>
          </tr>
        }
        </tbody>
      </table>
    </div>
    <p></p>
    <div class="heading-medium">
      Make another request
    </div>
  }
  @if(amendmentView.isHasAmendmentOrWithdrawalPermission) {
    @if(amendmentView.isApplicationInProgress) {
      @if(amendmentView.isHasPendingWithdrawalRequest) {
        You cannot make any further requests while your previous withdrawal request is pending.
      } else {
        @amendApplication(applicationSummaryView.getAppId, form, amendmentView)
      }
    } else {
      @if(amendmentView.getPreviousRequestItemViews.isEmpty) {
        No requests to amend or withdraw the application can be made as the application processing is complete.
      } else {
        No further requests to amend or withdraw the application can be made as the application processing is complete.
      }
    }
  } else {
    @if(amendmentView.isApplicationInProgress) {
      @if(amendmentView.getPreviousRequestItemViews.isEmpty) {
        There are no amendment or withdrawal requests and you do not have access rights to make a request.
      } else {
        You do not have access rights to make a request.
      }
    } else {
      TODO
    }
  }

  @officer(applicationSummaryView.getAppId, amendmentView.getOfficerView)
}
